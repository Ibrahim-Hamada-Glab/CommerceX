<div class="checkout-page">
  <div class="container">
    <!-- Page Header -->
    <div class="page-header">
      <a routerLink="/cart" class="back-link">
        <i class="fa-solid fa-arrow-left"></i>
        Back to Cart
      </a>
      <h1>Checkout</h1>
    </div>

    <div class="checkout-content">
      <!-- Main Form Section -->
      <div class="checkout-main">
        <!-- Progress Steps -->
        <div class="progress-steps">
          <div class="step" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1" (click)="goToStep(1)">
            <div class="step-number">
              <span *ngIf="currentStep <= 1">1</span>
              <i *ngIf="currentStep > 1" class="fa-solid fa-check"></i>
            </div>
            <span class="step-label">Shipping</span>
          </div>
          <div class="step-line" [class.active]="currentStep > 1"></div>
          <div class="step" [class.active]="currentStep >= 2" [class.completed]="currentStep > 2" (click)="goToStep(2)">
            <div class="step-number">
              <span *ngIf="currentStep <= 2">2</span>
              <i *ngIf="currentStep > 2" class="fa-solid fa-check"></i>
            </div>
            <span class="step-label">Payment</span>
          </div>
          <div class="step-line" [class.active]="currentStep > 2"></div>
          <div class="step" [class.active]="currentStep >= 3">
            <div class="step-number">3</div>
            <span class="step-label">Review</span>
          </div>
        </div>

        <!-- Step 1: Shipping -->
        <div class="form-section" *ngIf="currentStep === 1">
          <h2>Shipping Information</h2>
          <p class="section-desc">Enter your shipping details below</p>

          <form class="checkout-form">
            <div class="form-row">
              <div class="form-group">
                <label for="firstName">First Name</label>
                <input type="text" id="firstName" [(ngModel)]="shipping.firstName" name="firstName" placeholder="John" />
              </div>
              <div class="form-group">
                <label for="lastName">Last Name</label>
                <input type="text" id="lastName" [(ngModel)]="shipping.lastName" name="lastName" placeholder="Doe" />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="email">Email Address</label>
                <input type="email" id="email" [(ngModel)]="shipping.email" name="email" placeholder="john@example.com" />
              </div>
              <div class="form-group">
                <label for="phone">Phone Number</label>
                <input type="tel" id="phone" [(ngModel)]="shipping.phone" name="phone" placeholder="+1 (555) 000-0000" />
              </div>
            </div>

            <div class="form-group">
              <label for="address">Street Address</label>
              <input type="text" id="address" [(ngModel)]="shipping.address" name="address" placeholder="123 Main Street, Apt 4B" />
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="city">City</label>
                <input type="text" id="city" [(ngModel)]="shipping.city" name="city" placeholder="New York" />
              </div>
              <div class="form-group">
                <label for="state">State</label>
                <input type="text" id="state" [(ngModel)]="shipping.state" name="state" placeholder="NY" />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="zipCode">ZIP Code</label>
                <input type="text" id="zipCode" [(ngModel)]="shipping.zipCode" name="zipCode" placeholder="10001" />
              </div>
              <div class="form-group">
                <label for="country">Country</label>
                <select id="country" [(ngModel)]="shipping.country" name="country">
                  <option value="United States">United States</option>
                  <option value="Canada">Canada</option>
                  <option value="United Kingdom">United Kingdom</option>
                </select>
              </div>
            </div>
          </form>

          <div class="form-actions">
            <a routerLink="/cart" class="btn-secondary">
              <i class="fa-solid fa-arrow-left"></i>
              Back to Cart
            </a>
            <button class="btn-primary" (click)="nextStep()">
              Continue to Payment
              <i class="fa-solid fa-arrow-right"></i>
            </button>
          </div>
        </div>

        <!-- Step 2: Payment -->
        <div class="form-section" *ngIf="currentStep === 2">
          <h2>Payment Method</h2>
          <p class="section-desc">Enter your payment details securely</p>

          <form class="checkout-form">
            <div class="form-group">
              <label for="cardNumber">Card Number</label>
              <div class="input-with-icon">
                <input type="text" id="cardNumber" [(ngModel)]="payment.cardNumber" name="cardNumber" placeholder="1234 5678 9012 3456" />
                <div class="card-icons">
                  <i class="fa-brands fa-cc-visa"></i>
                  <i class="fa-brands fa-cc-mastercard"></i>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="cardName">Name on Card</label>
              <input type="text" id="cardName" [(ngModel)]="payment.cardName" name="cardName" placeholder="JOHN DOE" />
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="expiry">Expiry Date</label>
                <input type="text" id="expiry" [(ngModel)]="payment.expiry" name="expiry" placeholder="MM/YY" />
              </div>
              <div class="form-group">
                <label for="cvv">CVV</label>
                <div class="input-with-icon">
                  <input type="text" id="cvv" [(ngModel)]="payment.cvv" name="cvv" placeholder="123" />
                  <i class="fa-solid fa-circle-question cvv-help"></i>
                </div>
              </div>
            </div>

            <div class="secure-notice">
              <i class="fa-solid fa-lock"></i>
              <span>Your payment information is encrypted and secure</span>
            </div>
          </form>

          <div class="form-actions">
            <button class="btn-secondary" (click)="prevStep()">
              <i class="fa-solid fa-arrow-left"></i>
              Back to Shipping
            </button>
            <button class="btn-primary" (click)="nextStep()">
              Review Order
              <i class="fa-solid fa-arrow-right"></i>
            </button>
          </div>
        </div>

        <!-- Step 3: Review -->
        <div class="form-section" *ngIf="currentStep === 3">
          <h2>Review Your Order</h2>
          <p class="section-desc">Please review your order details before placing</p>

          <div class="review-sections">
            <!-- Shipping Review -->
            <div class="review-card">
              <div class="review-header">
                <h3><i class="fa-solid fa-truck"></i> Shipping Address</h3>
                <button class="btn-edit" (click)="goToStep(1)">Edit</button>
              </div>
              <div class="review-content">
                <p>{{ shipping.firstName }} {{ shipping.lastName }}</p>
                <p>{{ shipping.address }}</p>
                <p>{{ shipping.city }}, {{ shipping.state }} {{ shipping.zipCode }}</p>
                <p>{{ shipping.country }}</p>
                <p>{{ shipping.phone }}</p>
              </div>
            </div>

            <!-- Payment Review -->
            <div class="review-card">
              <div class="review-header">
                <h3><i class="fa-solid fa-credit-card"></i> Payment Method</h3>
                <button class="btn-edit" (click)="goToStep(2)">Edit</button>
              </div>
              <div class="review-content">
                <p><i class="fa-brands fa-cc-visa"></i> Visa ending in {{ payment.cardNumber.slice(-4) || '****' }}</p>
                <p>{{ payment.cardName || 'Card Holder' }}</p>
              </div>
            </div>

            <!-- Items Review -->
            <div class="review-card full-width">
              <div class="review-header">
                <h3><i class="fa-solid fa-box"></i> Order Items</h3>
                <a routerLink="/cart" class="btn-edit">Edit</a>
              </div>
              <div class="review-items">
                <div class="review-item" *ngFor="let item of orderItems">
                  <img [src]="item.image" [alt]="item.name" />
                  <div class="item-info">
                    <h4>{{ item.name }}</h4>
                    <p>Qty: {{ item.quantity }}</p>
                  </div>
                  <span class="item-price">{{ item.price * item.quantity | currency }}</span>
                </div>
              </div>
            </div>
          </div>

          <div class="form-actions">
            <button class="btn-secondary" (click)="prevStep()">
              <i class="fa-solid fa-arrow-left"></i>
              Back to Payment
            </button>
            <a routerLink="/order-confirmation" class="btn-primary btn-place-order" (click)="placeOrder()">
              <i class="fa-solid fa-lock"></i>
              Place Order - {{ total | currency }}
            </a>
          </div>
        </div>
      </div>

      <!-- Order Summary Sidebar -->
      <div class="order-summary">
        <h2 class="summary-title">Order Summary</h2>

        <div class="summary-items">
          <div class="summary-item" *ngFor="let item of orderItems">
            <img [src]="item.image" [alt]="item.name" />
            <div class="item-details">
              <h4>{{ item.name }}</h4>
              <p>Qty: {{ item.quantity }}</p>
            </div>
            <span class="item-price">{{ item.price * item.quantity | currency }}</span>
          </div>
        </div>

        <div class="summary-divider"></div>

        <div class="summary-row">
          <span>Subtotal</span>
          <span>{{ subtotal | currency }}</span>
        </div>

        <div class="summary-row">
          <span>Shipping</span>
          <span class="free">FREE</span>
        </div>

        <div class="summary-row">
          <span>Tax</span>
          <span>{{ tax | currency }}</span>
        </div>

        <div class="summary-divider"></div>

        <div class="summary-row total">
          <span>Total</span>
          <span>{{ total | currency }}</span>
        </div>
      </div>
    </div>
  </div>
</div>
